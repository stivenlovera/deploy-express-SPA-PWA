(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{nnsM:function(t,e,i){"use strict";i.r(e),i.d(e,"AsistenciaPageModule",function(){return E});var o=i("ofXK"),n=i("3Pt+"),a=i("TEn/"),c=i("tyNb"),r=i("fXoL"),s=i("Y6JD"),b=i("mrSG"),l=i("lDzL"),d=i("wd/R"),u=i("tk/3"),h=i("AytR"),p=i("gcOT"),m=i("XNvx");const{Camera:g,Filesystem:f}=p.d;let w=(()=>{class t{constructor(t,e,i){this.http=t,this.auth=e,this.api=h.a.backend.precisionWall,this.InicioPhotos=[],this.FinPhotos=[],this.Photo_storage="photos",this.convertBlobToBase64=t=>new Promise((e,i)=>{const o=new FileReader;o.onerror=i,o.onload=()=>{e(o.result)},o.readAsDataURL(t)}),this.platform=i,this.auth.getAuthUser$().subscribe(t=>{this.headers=new u.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${t.token}`})}),this.headers=new u.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${this.auth.getToken()}`})}addNewGalery(){return Object(b.a)(this,void 0,void 0,function*(){const t=yield g.getPhoto({resultType:p.a.Uri,source:p.b.Camera,quality:75,height:720,width:720});return yield this.savePicture(t)})}savePicture(t){return Object(b.a)(this,void 0,void 0,function*(){const e=yield this.readAsBase64(t),i=(new Date).getTime()+".jpeg",o=yield f.writeFile({path:i,data:e,directory:p.c.Data});return this.platform.is("hybrid"),{filepath:o.uri,webviewPath:e}})}readAsBase64(t){return Object(b.a)(this,void 0,void 0,function*(){if(this.platform.is("hybrid"))return(yield f.readFile({path:t.path})).data;{const e=yield fetch(t.webPath),i=yield e.blob();return yield this.convertBlobToBase64(i)}})}getAllActivities(t){return this.http.post(`${this.api}asistencia/list-activitis`,{from_date:t},{headers:this.headers})}getAllPersonalRegistroDiario(t,e){return this.http.post(`${this.api}asistencia/personal`,{actividadId:t,fecha:e},{headers:this.headers})}}return t.\u0275fac=function(e){return new(e||t)(r.Ub(u.a),r.Ub(m.a),r.Ub(a.W))},t.\u0275prov=r.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var P=i("BvB/");let v=(()=>{class t{constructor(t){this.dbService=t}getallActividades(t){return this.dbService.getAllByIndex("actividades","Fecha",IDBKeyRange.only(t))}}return t.\u0275fac=function(e){return new(e||t)(r.Ub(P.b))},t.\u0275prov=r.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Q=function(t){return["/asistencia/list-employee",t]},y=function(t,e,i,o,n,a,c,r){return{fecha:t,proyect:e,nameForeman:i,id_proyecto:o,nameProyecto:n,codigo:a,dirrecion:c,generalContractor:r}};function M(t,e){if(1&t&&(r.Qb(0,"ion-grid"),r.Qb(1,"ion-row"),r.Qb(2,"ion-col"),r.Qb(3,"small"),r.wc(4,"list tickets"),r.Pb(),r.Mb(5,"br"),r.Qb(6,"ion-button",19),r.wc(7," View Employee \xa0 "),r.Mb(8,"ion-icon",20),r.Pb(),r.Pb(),r.Qb(9,"ion-col"),r.Qb(10,"small"),r.wc(11,"Foreman"),r.Pb(),r.Mb(12,"br"),r.wc(13),r.Pb(),r.Qb(14,"ion-col"),r.Qb(15,"small"),r.wc(16,"Lead"),r.Pb(),r.Mb(17,"br"),r.wc(18),r.Pb(),r.Pb(),r.Pb()),2&t){const t=e.row;r.zb(6),r.gc("routerLink",r.ic(4,Q,t.Actividad_ID))("queryParams",r.lc(6,y,t.Fecha,t.Nombre,t.Foreman,t.Pro_ID,t.Nombre,t.Codigo,t.dirrecion,t.empresa)),r.zb(7),r.yc(" ",t.Foreman," "),r.zb(5),r.yc(" ",t.Lead," ")}}function C(t,e){if(1&t){const t=r.Rb();r.Qb(0,"a",21),r.Yb("click",function(){r.pc(t);const i=e.row;return r.ac().toggleExpandRow(i)}),r.Pb()}if(2&t){const t=e.expanded;r.Db("datatable-icon-right",!t)("datatable-icon-down",t)}}function D(t,e){1&t&&r.Mb(0,"i",22),2&t&&r.gc("innerHTML",e.row.Fecha,r.qc)}function z(t,e){1&t&&r.Mb(0,"i",22),2&t&&r.gc("innerHTML",e.row.empresa,r.qc)}function I(t,e){1&t&&r.Mb(0,"i",22),2&t&&r.gc("innerHTML",e.row.Nombre,r.qc)}function k(t,e){1&t&&r.Mb(0,"i",22),2&t&&r.gc("innerHTML",e.row.dirrecion,r.qc)}function x(t,e){1&t&&r.Mb(0,"i",22),2&t&&r.gc("innerHTML",e.row.Coordinador_Obra,r.qc)}let O=(()=>{class t{constructor(t,e){this.AsistenciaService=t,this.IndexDbService=e,this.columns=[{prop:"Fecha",name:"Date"},{prop:"empresa",name:"Company"},{prop:"Nombre",name:"Name"},{prop:"dirrecion",name:"Dirrecion"},{prop:"Coordinador_Obra",name:"Coordinador_Obra"},{prop:"Foreman",name:"Foreman"},{prop:"foreman_id",name:"foreman_id"},{prop:"Lead",name:"Lead"},{prop:"Pwtsuper",name:"Pwt super"},{prop:"empleados",name:"empleados"}],this.expanded={},this.loadingIndicator=!0,this.scrollBarHorizontal=window.innerWidth<1200,this.ColumnMode=l.a,window.onresize=()=>{this.scrollBarHorizontal=window.innerWidth<1200};const i=d().format("YYYY-MM-DD");this.fecha=new n.c(i),this.fecha.valueChanges.subscribe(t=>Object(b.a)(this,void 0,void 0,function*(){}))}onPage(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>{},1e3)}toggleExpandRow(t){this.table.rowDetail.toggleExpandRow(t)}onDetailToggle(t){}ngOnInit(){return Object(b.a)(this,void 0,void 0,function*(){yield this.loadDatatable()})}loadDatatable(){return Object(b.a)(this,void 0,void 0,function*(){this.AsistenciaService.getAllActivities(this.fecha.value).subscribe(t=>Object(b.a)(this,void 0,void 0,function*(){console.log(t);const e=t.map(t=>Object.assign(Object.assign({},t),{Fecha:d(t.Fecha).format("dddd DD-MM-YYYY")}));t&&(this.rows=e,this.temp=e,this.loadingIndicator=!1)}),t=>Object(b.a)(this,void 0,void 0,function*(){const t=d(this.fecha.value).format("YYYY-MM-DD");this.IndexDbService.getallActividades(t).subscribe(t=>{console.log(t),this.rows=t,this.temp=t,this.loadingIndicator=!1})}))})}buscar(){return Object(b.a)(this,void 0,void 0,function*(){this.loadingIndicator=!0,yield this.loadDatatable()})}updateFilter(t){const e=t.target.value.toLowerCase(),i=this.temp.filter(({empresa:t,Coordinador_Obra:i,Nombre:o,Fecha:n})=>t.toLowerCase().indexOf(e.toLowerCase())>-1||i.toLowerCase().indexOf(e.toLowerCase())>-1||o.toLowerCase().indexOf(e.toLowerCase())>-1||n.toLowerCase().indexOf(e.toLowerCase())>-1);this.rows=i,this.table.offset=3}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(w),r.Lb(v))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-datatable-list-activities"]],viewQuery:function(t,e){if(1&t&&r.Ac(l.d,1),2&t){let t;r.mc(t=r.Zb())&&(e.table=t.first)}},decls:30,vars:19,consts:[["size","9"],["displayFormat","DDDD MMM DD, YYYY",3,"formControl"],["size","3",1,"ion-align-self-center"],["expand","full",3,"click"],["name","search"],["position","floating"],["type","text",3,"keyup"],["rowHeight","auto",1,"material","expandable",3,"loadingIndicator","rows","limit","columnMode","headerHeight","footerHeight","scrollbarH","page"],["table",""],[3,"rowHeight","toggle"],["myDetailRow",""],["ngx-datatable-row-detail-template",""],[3,"width","resizeable","sortable","draggable","canAutoResize"],["ngx-datatable-cell-template",""],["name","Date",3,"width"],["name","Company",3,"width"],["name","Name",3,"width"],["name","Dirrection",3,"width"],["name","Contact",3,"width"],["size","small",3,"routerLink","queryParams"],["name","list-circle-outline"],["title","Expand/Collapse Row",3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(r.Qb(0,"ion-row"),r.Qb(1,"ion-col",0),r.Qb(2,"ion-item"),r.Mb(3,"ion-datetime",1),r.Pb(),r.Pb(),r.Qb(4,"ion-col",2),r.Qb(5,"ion-button",3),r.Yb("click",function(){return e.buscar()}),r.Mb(6,"ion-icon",4),r.Pb(),r.Pb(),r.Pb(),r.Mb(7,"hr"),r.Qb(8,"ion-item"),r.Qb(9,"ion-label",5),r.wc(10,"Search"),r.Pb(),r.Qb(11,"ion-input",6),r.Yb("keyup",function(t){return e.updateFilter(t)}),r.Pb(),r.Pb(),r.Mb(12,"br"),r.Qb(13,"ngx-datatable",7,8),r.Yb("page",function(t){return e.onPage(t)}),r.Qb(15,"ngx-datatable-row-detail",9,10),r.Yb("toggle",function(t){return e.onDetailToggle(t)}),r.uc(17,M,19,15,"ng-template",11),r.Pb(),r.Qb(18,"ngx-datatable-column",12),r.uc(19,C,1,4,"ng-template",13),r.Pb(),r.Qb(20,"ngx-datatable-column",14),r.uc(21,D,1,1,"ng-template",13),r.Pb(),r.Qb(22,"ngx-datatable-column",15),r.uc(23,z,1,1,"ng-template",13),r.Pb(),r.Qb(24,"ngx-datatable-column",16),r.uc(25,I,1,1,"ng-template",13),r.Pb(),r.Qb(26,"ngx-datatable-column",17),r.uc(27,k,1,1,"ng-template",13),r.Pb(),r.Qb(28,"ngx-datatable-column",18),r.uc(29,x,1,1,"ng-template",13),r.Pb(),r.Pb()),2&t&&(r.zb(3),r.gc("formControl",e.fecha),r.zb(10),r.gc("loadingIndicator",e.loadingIndicator)("rows",e.rows)("limit",15)("columnMode",e.ColumnMode.force)("headerHeight",50)("footerHeight",50)("scrollbarH",e.scrollBarHorizontal),r.zb(2),r.gc("rowHeight",95),r.zb(3),r.gc("width",50)("resizeable",!1)("sortable",!1)("draggable",!1)("canAutoResize",!1),r.zb(2),r.gc("width",200),r.zb(2),r.gc("width",150),r.zb(2),r.gc("width",200),r.zb(2),r.gc("width",200),r.zb(2),r.gc("width",200))},directives:[a.E,a.m,a.v,a.o,a.Y,n.l,n.d,a.e,a.s,a.w,a.u,a.Z,l.d,l.e,l.f,l.c,l.b,a.q,a.X,c.h],styles:[""]}),t})(),L=(()=>{class t{constructor(t,e){this.menuCrtl=t,this.sicronizacionDb=e,this.sicronizacionDb.verificarConection(),this.sicronizacionDb.postSyncronizacion()}ngOnInit(){}ionViewWillEnter(){this.menuCrtl.enable(!0)}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(a.S),r.Lb(s.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-list-actividades"]],decls:13,vars:1,consts:[[3,"translucent"],["slot","start"],["slot","end"]],template:function(t,e){1&t&&(r.Qb(0,"ion-header",0),r.Qb(1,"ion-toolbar"),r.Qb(2,"ion-buttons",1),r.Mb(3,"ion-menu-button"),r.Pb(),r.Qb(4,"ion-title"),r.wc(5,"Attendance - activities list"),r.Pb(),r.Qb(6,"ion-buttons",2),r.Mb(7,"ion-back-button"),r.Pb(),r.Pb(),r.Pb(),r.Qb(8,"ion-content"),r.Qb(9,"ion-grid"),r.Qb(10,"ion-row"),r.Qb(11,"ion-col"),r.Mb(12,"app-datatable-list-activities"),r.Pb(),r.Pb(),r.Pb(),r.Pb()),2&t&&r.gc("translucent",!0)},directives:[a.r,a.O,a.f,a.A,a.N,a.c,a.d,a.n,a.q,a.E,a.m,O],styles:[""]}),t})();function Y(t,e){if(1&t&&r.Mb(0,"ion-img",11),2&t){const t=r.ac();r.gc("src",t.photo.webviewPath)}}let A=(()=>{class t{constructor(t,e){this.modalController=t,this.asistenciaService=e,this.image=!1,this.clock=""}ngOnInit(){this.clockHandle=setInterval(()=>{this.clock=d().format("HH:mm:ss")},1e3)}newPhoto(){return Object(b.a)(this,void 0,void 0,function*(){this.image=!0;const t=yield this.asistenciaService.addNewGalery();this.photo=t,console.log(this.photo)})}close(){this.modalController.dismiss({dismissed:!0})}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(a.T),r.Lb(w))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-check"]],decls:28,vars:3,consts:[["slot","end","color","light",3,"click"],["slot","icon-only","name","close"],["padding",""],["size","12",1,"centrado"],[1,"img"],[3,"src",4,"ngIf"],["type","button",3,"click"],["name","camera-outline"],["position","stacked"],["expand","full",3,"disabled"],["expand","full",3,"click"],[3,"src"]],template:function(t,e){1&t&&(r.Qb(0,"ion-header"),r.Qb(1,"ion-toolbar"),r.Qb(2,"ion-title"),r.wc(3,"Check In "),r.Pb(),r.Qb(4,"ion-button",0),r.Yb("click",function(){return e.close()}),r.Mb(5,"ion-icon",1),r.Pb(),r.Pb(),r.Pb(),r.Qb(6,"ion-content",2),r.Qb(7,"ion-grid"),r.Qb(8,"ion-row"),r.Qb(9,"ion-col",3),r.Qb(10,"ion-thumbnail",4),r.uc(11,Y,1,1,"ion-img",5),r.Pb(),r.Qb(12,"ion-button",6),r.Yb("click",function(){return e.newPhoto()}),r.Mb(13,"ion-icon",7),r.wc(14," \xa0 Capture photo "),r.Pb(),r.Pb(),r.Qb(15,"ion-col",3),r.Qb(16,"ion-label",8),r.wc(17,"Time:"),r.Pb(),r.wc(18),r.Pb(),r.Pb(),r.Pb(),r.Pb(),r.Qb(19,"ion-footer"),r.Qb(20,"ion-grid"),r.Qb(21,"ion-row"),r.Qb(22,"ion-col"),r.Qb(23,"ion-button",9),r.wc(24,"Save"),r.Pb(),r.Pb(),r.Qb(25,"ion-col"),r.Qb(26,"ion-button",10),r.Yb("click",function(){return e.close()}),r.wc(27,"Close"),r.Pb(),r.Pb(),r.Pb(),r.Pb(),r.Pb()),2&t&&(r.zb(11),r.gc("ngIf",e.photo),r.zb(7),r.yc(" ",e.clock," "),r.zb(5),r.gc("disabled",!e.photo))},directives:[a.r,a.O,a.N,a.e,a.s,a.n,a.q,a.E,a.m,a.M,o.k,a.w,a.p,a.t],styles:["ion-thumbnail[_ngcontent-%COMP%]{--size:270px}.centrado[_ngcontent-%COMP%]{text-align:center}.img[_ngcontent-%COMP%]{margin:auto;display:block}"]}),t})();function F(t,e){1&t&&(r.Qb(0,"ion-thumbnail",12),r.Mb(1,"ion-img",13),r.Pb())}function H(t,e){if(1&t&&(r.Qb(0,"p"),r.wc(1),r.Pb()),2&t){const t=r.ac().$implicit;r.zb(1),r.xc(t.Hora_Ingreso)}}function _(t,e){if(1&t){const t=r.Rb();r.Qb(0,"ion-icon",14),r.Yb("click",function(){r.pc(t);const e=r.ac().$implicit;return r.ac().ModalCheck(e.empleado_id)}),r.Pb()}}function R(t,e){1&t&&(r.Qb(0,"ion-thumbnail",12),r.Mb(1,"ion-img",13),r.Pb())}function j(t,e){if(1&t&&(r.Qb(0,"p"),r.wc(1),r.Pb()),2&t){const t=r.ac().$implicit;r.zb(1),r.xc(t.Hora_Salida)}}function T(t,e){if(1&t){const t=r.Rb();r.Qb(0,"ion-icon",14),r.Yb("click",function(){r.pc(t);const e=r.ac().$implicit;return r.ac().ModalCheck(e.empleado_id)}),r.Pb()}}function q(t,e){if(1&t&&(r.Qb(0,"ion-col",5),r.Qb(1,"ion-card"),r.Qb(2,"ion-card-header"),r.Qb(3,"ion-card-subtitle"),r.wc(4),r.Pb(),r.Pb(),r.Qb(5,"ion-card-content"),r.Qb(6,"ion-grid"),r.Qb(7,"ion-row"),r.Qb(8,"ion-col",6),r.Qb(9,"ion-label"),r.wc(10," Check In "),r.Pb(),r.uc(11,F,2,0,"ion-thumbnail",7),r.uc(12,H,2,1,"p",8),r.uc(13,_,1,0,"ng-template",null,9,r.vc),r.Pb(),r.Qb(15,"ion-col",6),r.Qb(16,"ion-label"),r.wc(17," Check Out "),r.Pb(),r.uc(18,R,2,0,"ion-thumbnail",7),r.uc(19,j,2,1,"p",8),r.uc(20,T,1,0,"ng-template",null,10,r.vc),r.Pb(),r.Pb(),r.Pb(),r.Qb(22,"ion-button",11),r.wc(23,"Detail reports"),r.Pb(),r.Pb(),r.Pb(),r.Pb()),2&t){const t=e.$implicit,i=r.nc(14),o=r.nc(21);r.zb(4),r.xc(t.nombre),r.zb(7),r.gc("ngIf",t.foto_ingreso)("ngIfElse",i),r.zb(1),r.gc("ngIf",t.foto_ingreso),r.zb(6),r.gc("ngIf",t.foto_salida)("ngIfElse",o),r.zb(1),r.gc("ngIf",t.foto_salida)}}const S=[{path:"",redirectTo:"list-activities"},{path:"list-activities",component:L},{path:"list-employee/:actividadID",component:(()=>{class t{constructor(t,e,i,o,n){this.route=t,this.asistenciaService=e,this.indexDbService=i,this.modalController=o,this.sicronizacionDb=n,this.actividadID=parseInt(this.route.snapshot.paramMap.get("actividadID")),this.fecha=this.route.snapshot.queryParams.fecha,this.nombreProyecto=this.route.snapshot.queryParams.proyect,this.sicronizacionDb.verificarConection(),this.sicronizacionDb.postSyncronizacion()}ngOnInit(){this.listPersonalRegistroDiario()}listPersonalRegistroDiario(){const t=d(this.fecha,"dddd DD-MM-YYYY").format("YYYY-MM-DD");this.asistenciaService.getAllPersonalRegistroDiario(this.actividadID,t).subscribe(t=>{this.empleados=t})}ModalCheck(t){return Object(b.a)(this,void 0,void 0,function*(){console.log(t);const e=yield this.modalController.create({component:A,componentProps:{actividadId:this.actividadID,fecha:this.fecha},cssClass:"my-custom-class"});return yield e.present()})}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(c.a),r.Lb(w),r.Lb(v),r.Lb(a.T),r.Lb(s.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-list-personal"]],decls:16,vars:4,consts:[[3,"translucent"],["slot","start"],["slot","end"],[1,"ion-no-border"],["size","12",4,"ngFor","ngForOf"],["size","12"],[1,"centrado"],["class","img",4,"ngIf","ngIfElse"],[4,"ngIf"],["noFotoEntrada",""],["noFotoSalida",""],["expand","full"],[1,"img"],["src","https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQl-Iur9bkdneD-LrHY7FxrR6LxjVc0ZL0MAg&usqp=CAU"],["name","create-outline",1,"img",3,"click"]],template:function(t,e){1&t&&(r.Qb(0,"ion-header",0),r.Qb(1,"ion-toolbar"),r.Qb(2,"ion-buttons",1),r.Mb(3,"ion-menu-button"),r.Pb(),r.Qb(4,"ion-title"),r.wc(5,"Attendance - employee list"),r.Pb(),r.Qb(6,"ion-buttons",2),r.Mb(7,"ion-back-button"),r.Pb(),r.Pb(),r.Pb(),r.Qb(8,"ion-content"),r.Qb(9,"ion-grid"),r.Qb(10,"ion-header",3),r.Qb(11,"ion-toolbar"),r.Qb(12,"ion-title"),r.wc(13),r.Pb(),r.Pb(),r.Pb(),r.Qb(14,"ion-row"),r.uc(15,q,24,7,"ion-col",4),r.Pb(),r.Pb(),r.Pb()),2&t&&(r.gc("translucent",!0),r.zb(13),r.zc("Proyect - ",e.nombreProyecto," || ",e.fecha,""),r.zb(2),r.gc("ngForOf",e.empleados))},directives:[a.r,a.O,a.f,a.A,a.N,a.c,a.d,a.n,a.q,a.E,o.j,a.m,a.g,a.i,a.j,a.h,a.w,o.k,a.e,a.M,a.t,a.s],styles:["ion-thumbnail[_ngcontent-%COMP%]{--size:120px}.centrado[_ngcontent-%COMP%]{text-align:center}.img[_ngcontent-%COMP%]{margin:auto;display:block}ion-icon[_ngcontent-%COMP%]{font-size:120px}"]}),t})()}];let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({imports:[[c.j.forChild(S)],c.j]}),t})(),E=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({imports:[[o.c,n.h,a.P,B,l.g,u.b,n.o]]}),t})()}}]);