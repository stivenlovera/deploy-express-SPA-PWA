(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{IDvd:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var r=i("fXoL"),a=i("BvB/");let s=(()=>{class e{constructor(e){this.dbService=e}deleteTicketPendiente(e){return this.dbService.deleteByKey("pendiente_ticket",e)}getOneTicketPendiente(e){return this.dbService.getByKey("pendiente_ticket",e)}getAllTicketPendiente(){return this.dbService.getAll("pendiente_ticket")}getAllTicketPendienteMateriales(e){return this.dbService.getAllByIndex("pendiente_ticket_materiales","id_ticket",IDBKeyRange.only(e))}getAllTicketPendienteClassWorker(e){return this.dbService.getAllByIndex("pendiente_ticket_workers","id_ticket",IDBKeyRange.only(e))}getAllTicketPendienteImagesInicio(e){return this.dbService.getAllByIndex("pendiente_ticket_img_inicio","id_ticket",IDBKeyRange.only(e))}getAllTicketPendienteImagesFinal(e){return this.dbService.getAllByIndex("pendiente_ticket_img_final","id_ticket",IDBKeyRange.only(e))}getallActividades(e){return this.dbService.getAllByIndex("actividades","Fecha",IDBKeyRange.only(e))}getallpersonal(){return this.dbService.getAll("personal")}getallTicketById(e){return this.dbService.getAllByIndex("tickets","actividad_id",IDBKeyRange.only(e))}getallWhat(){return this.dbService.getAll("what")}getallWhere(){return this.dbService.getAll("where")}getallWhy(){return this.dbService.getAll("why")}getallMateriales(){return this.dbService.getAll("materiales")}getallClassWorker(){return this.dbService.getAll("tipo_trabajo")}deleteStoreListActivities(){return this.dbService.clear("actividades")}deleteStoreListTickets(){return this.dbService.clear("actividades")}countRegister(){return this.dbService.count("actividades")}getOneTicket(e){return this.dbService.getByIndex("tickets","ticket_id",parseInt(e))}getAllTicketMaterial(e){return this.dbService.getAllByIndex("ticket_materiales","ticket_id",IDBKeyRange.only(parseInt(e)))}getAllTicketWorkers(e){return this.dbService.getAllByIndex("ticket_trabajadores","ticket_id",IDBKeyRange.only(parseInt(e)))}getAllTicketImages(e){return this.dbService.getAllByIndex("imagen_ticket","ticket_id",IDBKeyRange.only(parseInt(e)))}getAllMailProyect(e){return this.dbService.getAllByIndex("mail_proyect","Pro_ID",IDBKeyRange.only(parseInt(e)))}getAllMailContact(e){return this.dbService.getAllByIndex("mail_contac","Pro_ID",IDBKeyRange.only(parseInt(e)))}addNewTicketPendiente(e,t){return console.log(e),this.dbService.add("pendiente_ticket",{tipo:"nuevo",assignTicket:e.assignTicket,empleado_id:e.empleado_id,general_contractor:e.general_contractor,proyect:e.proyect,proyect_nombre:e.proyect_nombre,proyect_address:e.proyect_address,date_work:e.date_work,foreman_name:e.foreman_name,pco:e.pco,horario:e.horario,descripcion:e.descripcion,id_proyecto:e.id_proyecto,superintendente_name:e.superintendente_name,finish_date:e.finish_date,signarute_foreman:e.signarute_foreman,signature_superintendente:e.signature_superintendente,actividad_id:t})}addNewTicketMateriales(e,t){return this.dbService.addItem("pendiente_ticket_materiales",{id_material:e.id_material,descripcion:e.descripcion,unidad_medida:e.unidad_medida,cantidad:e.cantidad,id_ticket:t})}addNewTicketClassWorker(e,t){return this.dbService.addItem("pendiente_ticket_workers",{n_worker:e.n_worker,n_class_worker:e.n_class_worker,id_class_worker:e.id_class_worker,reg_hours:e.reg_hours,total_reg_hours:e.total_reg_hours,premium_hours:e.premium_hours,total_premium_hours:e.total_premium_hours,out_hours:e.out_hours,total_out_hours:e.total_out_hours,prepaid_hours:e.prepaid_hours,total_prepaid_hours:e.total_prepaid_hours,id_ticket:t})}addNewTicketImageFinal(e,t){return this.dbService.addItem("pendiente_ticket_img_final",{filepath:e.filepath,webviewPath:e.webviewPath,id_ticket:t})}addNewTicketImageInicio(e,t){return this.dbService.addItem("pendiente_ticket_img_inicio",{filepath:e.filepath,webviewPath:e.webviewPath,id_ticket:t})}}return e.\u0275fac=function(t){return new(t||e)(r.Ub(a.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},JwAU:function(e,t,i){"use strict";i.d(t,"a",function(){return _});var r=i("mrSG"),a=i("tk/3"),s=i("AytR"),o=i("gcOT"),n=i("fXoL"),d=i("TEn/"),c=i("XNvx");const{Camera:h,Filesystem:l,Storage:u}=o.d;let _=(()=>{class e{constructor(e,t,i){this.http=e,this.auth=i,this.items=[],this.InicioPhotos=[],this.FinPhotos=[],this.Photo_storage="photos",this.api=s.a.backend.precisionWall,this.convertBlobToBase64=e=>new Promise((t,i)=>{const r=new FileReader;r.onerror=i,r.onload=()=>{t(r.result)},r.readAsDataURL(e)}),this.platform=t,this.auth.getAuthUser$().subscribe(e=>{this.headers=new a.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${e.token}`})}),this.headers=new a.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${this.auth.getToken()}`})}addNewGalery(e){return Object(r.a)(this,void 0,void 0,function*(){const e=yield h.getPhoto({resultType:o.a.Uri,source:o.b.Camera,quality:75});return yield this.savePicture(e)})}loadSaved(e){return Object(r.a)(this,void 0,void 0,function*(){const t=yield u.get({key:this.Photo_storage});if("Previous"===e){if(this.InicioPhotos=JSON.parse(t.value)||[],!this.platform.is("hybrid"))for(let e of this.InicioPhotos){const t=yield l.readFile({path:e.filepath,directory:o.c.Data});e.webviewPath=`data:image/jpeg;base64,${t.data}`}}else if(this.FinPhotos=JSON.parse(t.value)||[],!this.platform.is("hybrid"))for(let e of this.FinPhotos){const t=yield l.readFile({path:e.filepath,directory:o.c.Data});e.webviewPath=`data:image/jpeg;base64,${t.data}`}})}getPhotos(e){return"inicio"===e?this.InicioPhotos:this.FinPhotos}savePicture(e){return Object(r.a)(this,void 0,void 0,function*(){const t=yield this.readAsBase64(e),i=(new Date).getTime()+".jpeg",r=yield l.writeFile({path:i,data:t,directory:o.c.Data});return this.platform.is("hybrid"),{filepath:r.uri,webviewPath:t}})}readAsBase64(e){return Object(r.a)(this,void 0,void 0,function*(){if(this.platform.is("hybrid"))return(yield l.readFile({path:e.path})).data;{const t=yield fetch(e.webPath),i=yield t.blob();return yield this.convertBlobToBase64(i)}})}deleteAllImagen(){return Object(r.a)(this,void 0,void 0,function*(){yield u.remove({key:this.Photo_storage})})}getPhotosFile(e,t){return Object(r.a)(this,void 0,void 0,function*(){return{filepath:t,webviewPath:e.webPath}})}getSelectAllWhat(){return this.http.get(`${this.api}ticket/what`,{headers:this.headers})}getSelectAllWhere(){return this.http.get(`${this.api}ticket/where`,{headers:this.headers})}getSelectAllWhy(){return this.http.get(`${this.api}ticket/why`,{headers:this.headers})}getSelectAllClassWorker(){return this.http.get(`${this.api}ticket/classWorker`,{headers:this.headers})}getSelectAllPersonal(){return this.http.get(`${this.api}ticket/personal`,{headers:this.headers})}getSelectSearchMaterial(e){return this.http.get(`${this.api}ticket/materiales/${e}`,{headers:this.headers})}getSelectSearchWorker(e,t){return this.http.get(`${this.api}ticket/${e}/${t}`,{headers:this.headers})}getDataTable(){return this.http.get("https://api.anniix.com/api-anime/anniix/ejemplo",{headers:this.headers})}getDataTableListActivitis(e){return this.http.post(`${this.api}ticket/list-activitis`,{from_date:e},{headers:this.headers})}getDataTableListTicket(e){return this.http.post(`${this.api}ticket/list-ticket/${e}`,{},{headers:this.headers})}postSaveTicket(e,t){return this.http.post(`${this.api}ticket/${t}/store`,e,{headers:this.headers})}getOneTicket(e){return this.http.get(`${this.api}ticket/edit/${e}`,{headers:this.headers})}updateTicket(e,t){return this.http.put(`${this.api}ticket/update/${t}`,e,{headers:this.headers})}deleteTicket(e){return this.http.delete(`${this.api}ticket/delete/${e}`,{headers:this.headers})}getMail(e){return this.http.get(`${this.api}ticket/send_ticket/${e}`,{headers:this.headers})}sendMail(e,t){return this.http.post(`${this.api}ticket/${e}/send`,t,{headers:this.headers})}getImage(e,t){return this.http.get(`${this.api}get_images/${e}/${t}/ticket`,{headers:this.headers})}uploadImage(e,t){return this.http.get(`${this.api}upload_image/${e}/${t}/ticket/{nombre_camp?}`,{headers:this.headers})}}return e.\u0275fac=function(t){return new(t||e)(n.Ub(a.a),n.Ub(d.W),n.Ub(c.a))},e.\u0275prov=n.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},Y6JD:function(e,t,i){"use strict";i.d(t,"a",function(){return k});var r=i("mrSG"),a=i("tk/3"),s=i("VRyK"),o=i("xgIS"),n=i("HDdC"),d=i("lJxs"),c=i("AytR"),h=i("fXoL"),l=i("TEn/"),u=i("BvB/"),_=i("JwAU"),p=i("XNvx");let k=(()=>{class e{constructor(e,t,i,r,s){this.toastController=e,this.dbService=t,this.serviceTicket=i,this.http=r,this.auth=s,this.api=c.a.backend.precisionWall,this.verificarConection(),this.auth.getAuthUser$().subscribe(e=>{this.headers=new a.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${e.token}`})}),this.headers=new a.c({"Content-type":"application/json","Access-Control-Allow-Origin":"*","X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${this.auth.getToken()}`})}verificarConection(){return Object(r.a)(this,void 0,void 0,function*(){this.createOnline$().subscribe(e=>Object(r.a)(this,void 0,void 0,function*(){this.isConnected=e,!0===this.isConnected?(yield this.alertToast("Online mode",1500),this.ticketPendiente()):yield this.alertToast("Offline mode",1500)}))})}createOnline$(){return Object(s.a)(Object(o.a)(window,"offline").pipe(Object(d.a)(()=>!1)),Object(o.a)(window,"online").pipe(Object(d.a)(()=>!0)),new n.a(e=>{e.next(navigator.onLine),e.complete()}))}alertToast(e,t){return Object(r.a)(this,void 0,void 0,function*(){const i=yield this.toastController.create({color:"dark",message:e,duration:t});i.present(),yield i.onDidDismiss()})}ticketPendiente(){this.dbService.getAll("pendiente_ticket").subscribe(e=>{e.forEach(e=>Object(r.a)(this,void 0,void 0,function*(){const t=yield this.dbService.getAllByIndex("pendiente_ticket_materiales","id_ticket",IDBKeyRange.only(e.id)).toPromise();e=Object.assign(e,{materiales:t});const i=yield this.dbService.getAllByIndex("pendiente_ticket_workers","id_ticket",IDBKeyRange.only(e.id)).toPromise();e=Object.assign(e,{workers:i});const r=yield this.dbService.getAllByIndex("pendiente_ticket_img_inicio","id_ticket",IDBKeyRange.only(e.id)).toPromise();e=Object.assign(e,{imagesInicio:r});const a=yield this.dbService.getAllByIndex("pendiente_ticket_img_final","id_ticket",IDBKeyRange.only(e.id)).toPromise();e=Object.assign(e,{imagesFinal:a})}));for(const t of e)"nuevo"===t.tipo&&this.serviceTicket.postSaveTicket(t,t.actividad_id).subscribe(e=>Object(r.a)(this,void 0,void 0,function*(){console.log(t.id),this.alertToast("Pending ticket successfully submitted",3e3),yield this.dbService.deleteByKey("pendiente_ticket",t.id).toPromise()}),e=>Object(r.a)(this,void 0,void 0,function*(){this.alertToast("Pending ticket was not sent connection error",3e3)}))})}postSyncronizacion(){return Object(r.a)(this,void 0,void 0,function*(){const e=yield this.getOneApp().toPromise();console.log(e.fecha);const t=yield this.http.post(`${this.api}db-app`,{fecha:e.fecha},{headers:this.headers}).toPromise();yield this.verficarInsertTicket(t.tickets.nuevo),yield this.verficarDeleteTicket(t.tickets.eliminado),yield this.verficarInsertTicketMaterial(t.tickets_materiales.nuevo),yield this.verficarDeleteTicketMaterial(t.tickets_materiales.eliminado),yield this.verficarInsertTicketTrabajadores(t.tickets_trabajadores.nuevo),yield this.verficarDeleteTicketTrabajadores(t.tickets_trabajadores.eliminado),yield this.dbService.update("app",{id:0,fecha:t.fecha,codigo:t.codigo}).toPromise()})}getOneApp(){return this.dbService.getByKey("app",0)}verficarDeleteTicket(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("tickets","ticket_id",t.ticket_id).toPromise();void 0!==e&&(yield this.dbService.deleteByKey("tickets",e.id).toPromise())}})}verficarInsertTicket(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("tickets","ticket_id",t.ticket_id).toPromise();void 0===e?yield this.dbService.add("tickets",t).toPromise():yield this.dbService.update("tickets",{id:e.id,ticket_id:t.ticket_id,assignTicket:t.assignTicket,empleado_id:t.empleado_id,general_contractor:t.general_contractor,proyect:t.proyect,proyect_nombre:t.proyect_nombre,proyect_address:t.proyect_address,date_work:t.date_work,foreman_name:t.foreman_name,pco:t.pco,Num:t.Num,horario:t.horario,descripcion:t.descripcion,id_proyecto:t.id_proyecto,superintendente_name:t.superintendente_name,finish_date:t.finish_date,signarute_foreman:t.signarute_foreman,signature_superintendente:t.signature_superintendente,actividad_id:t.actividad_id}).toPromise()}})}verficarInsertTicketMaterial(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("ticket_materiales","id_ticket_material",t.id_ticket_material).toPromise();void 0===e?yield this.dbService.add("ticket_materiales",t).toPromise():yield this.dbService.update("ticket_materiales",{id:e.id,ticket_id:t.ticket_id,id_ticket_material:t.id_ticket_material,cantidad:t.cantidad,descripcion:t.denominacion,id_material:t.material_id,unidad_medida:t.unidad_medida}).toPromise()}})}verficarDeleteTicketMaterial(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("ticket_materiales","id_ticket_material",t).toPromise();void 0!==e&&(yield this.dbService.deleteByKey("ticket_materiales",e.id).toPromise())}})}verficarInsertTicketTrabajadores(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("ticket_trabajadores","id_ticket_trabajadores",t.id_ticket_trabajadores).toPromise();void 0===e?yield this.dbService.add("ticket_trabajadores",t).toPromise():yield this.dbService.update("ticket_trabajadores",{id:e.id,ticket_id:t.ticket_id,id_ticket_trabajadores:t.id_ticket_trabajadores,n_worker:t.n_worker,n_class_worker:t.n_class_worker,id_class_worker:t.id_class_worker,reg_hours:t.reg_hours,total_reg_hours:t.total_reg_hours,premium_hours:t.premium_hours,total_premium_hours:t.total_premium_hours,out_hours:t.out_hours,total_out_hours:t.total_out_hours,prepaid_hours:t.prepaid_hours,total_prepaid_hours:t.total_prepaid_hours}).toPromise()}})}verficarDeleteTicketTrabajadores(e){return Object(r.a)(this,void 0,void 0,function*(){for(const t of e){const e=yield this.dbService.getByIndex("ticket_trabajadores","id_ticket_trabajadores",t).toPromise();void 0!==e&&(yield this.dbService.deleteByKey("ticket_trabajadores",e.id).toPromise())}})}}return e.\u0275fac=function(t){return new(t||e)(h.Ub(l.ab),h.Ub(u.b),h.Ub(_.a),h.Ub(a.a),h.Ub(p.a))},e.\u0275prov=h.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);